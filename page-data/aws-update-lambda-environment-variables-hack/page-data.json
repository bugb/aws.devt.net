{"componentChunkName":"component---src-templates-blog-template-js","path":"/aws-update-lambda-environment-variables-hack","result":{"data":{"markdownRemark":{"html":"<p>Sometimes we need to save/update environment variables, suppose you have a small set of data and you do not want to save it on external services like S3, DynamoDB</p>\n<p>And you might think create a code likes this:</p>\n<pre><code>  process.env[\"my_var_1\"] = \"something\";\n  process.env[\"my_var_2\"] = \"something_different\";\n</code></pre>\n<p>But each time you run AWS lambda, it will create an isolated environments so you can not set environment variables likes the example above.</p>\n<p>Fortunately, we can use AWS Lambda as a mini database. I have used it for very long time ago and I want to share it here for fun and profit because as you know AWS Lambda is pretty dirty cheap. The hacky way is we can use Lambda update function configuration to update environment variable. Here is my example with Nodejs (you can use any language just Google Lambda update function configuration + your SDK): </p>\n<ol>\n<li>Create a lambda function with any name that you like for example: test-update-env</li>\n<li>Paste the code below to your function:</li>\n</ol>\n<pre><code>  const AWS = require('aws-sdk');\n  const lambda = new AWS.Lambda();\n\n  exports.handler = async(event) => {\n      const params = {\n      FunctionName: \"test-update-env\",\n      Environment: {\n          Variables: {\n          'MY_VAR_1': 'Foo', // Set process.env.MY_VAR_1 = 'Foo'\n          }\n      },\n      };\n      await lambda.updateFunctionConfiguration(params).promise();\n      const response = {\n      statusCode: 200,\n      body: JSON.stringify('Update env successfully!'),\n      };\n      return response;\n  };\n</code></pre>\n<ol start=\"3\">\n<li>Now run this function and press F5 and you can see the function now has environment variable <code>MY_VAR_1</code> with value: <code>Foo</code></li>\n<li>Modify the code a bit:</li>\n</ol>\n<pre><code>  const AWS = require('aws-sdk');\n  const lambda = new AWS.Lambda();\n\n  exports.handler = async(event) => {\n      const params = {\n      FunctionName: \"test-update-env\",\n      Environment: {\n          Variables: {\n          'MY_VAR_1': 'New Foo', // update process.env.MY_VAR_1 = 'New Foo'\n          'MY_VAR_2': 'Bar', // Set process.env.MY_VAR_2 = 'Bar'\n          }\n      },\n      };\n      await lambda.updateFunctionConfiguration(params).promise();\n      const response = {\n      statusCode: 200,\n      body: JSON.stringify('Update env successfully!'),\n      };\n      return response;\n  };\n</code></pre>\n<ol start=\"5\">\n<li>Now run this again and you can see the function now has updated environment variable <code>MY_VAR_1</code> with a new value: <code>New foo</code> and new environment variable <code>MY_VAR_2</code> with value: <code>Bar</code></li>\n</ol>\n<p>Now you get the idea, you can get any value likes token from API call, calendar/booking data, ... and set/update it to environment variables.</p>\n<p>Note: AWS Lambda environment variable has 4Kb limit, it means if you use normal English characters we can store 4000 characters (not so bad at all). See detail <a href=\"https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-limits.html\">here</a>! </p>\n<p>You can use my tool here for counting bytes online: <a href=\"https://minitool.github.io/countbytesonline/\">https://minitool.github.io/countbytesonline/</a></p>\n<p>In the next article I will share a post about using Lambda as a real database so we do not need to worry about the limitation above.</p>\n<p>Please share this article and comment if you like the article!</p>","frontmatter":{"date":"October 20, 2020","slug":"aws-update-lambda-environment-variables-hack","title":"Using AWS Lambda as a (mini) database - Part 1: update Lambda environment variables hack"}}},"pageContext":{"slug":"aws-update-lambda-environment-variables-hack"}},"staticQueryHashes":[]}