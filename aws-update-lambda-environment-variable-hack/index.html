<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 2.24.79"/><link as="script" rel="preload" href="/webpack-runtime-9f342ce237c6601c3595.js"/><link as="script" rel="preload" href="/framework-acb96471af32e2ccbc9d.js"/><link as="script" rel="preload" href="/app-a6843f43ed10aa8685cb.js"/><link as="script" rel="preload" href="/component---src-templates-blog-template-js-c62a2913b1733c7d003a.js"/><link as="fetch" rel="preload" href="/page-data/aws-update-lambda-environment-variable-hack/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="blog-post-container"><div class="blog-post"><h1>AWS update lambda environment hack</h1><h2>October 20, 2020</h2><div class="blog-post-content"><p>Sometimes we need to save/update environment variables, suppose you have a small set of data and you do not want to save it on external services like S3, DynamoDB</p>
<p>And you might think create a code likes this:</p>
<pre><code>process.env["my_var_1"] = "something";
process.env["my_var_2"] = "something_different";
</code></pre>
<p>But each time you run AWS lambda, it will create an isolated environments so you can not set environment variables likes the example above.</p>
<p>After spend some minutes, I am able to make it works. The hacky way is we can use lambda update function configuration to update environment variable. Here is my example with Nodejs (you can use any language just Google lambda update function configuration + your SDK): </p>
<ol>
<li>Create a lambda function with any name that you like for example: test-update-env</li>
<li>Paste the code below to your function:</li>
</ol>
<pre><code>  const AWS = require('aws-sdk');
  const lambda = new AWS.Lambda();

  exports.handler = async(event) => {
      const params = {
      FunctionName: "test-update-env",
      Environment: {
          Variables: {
          'MY_VAR_1': 'Foo', // Set process.env.MY_VAR_1 = 'Foo'
          }
      },
      };
      await lambda.updateFunctionConfiguration(params).promise();
      const response = {
      statusCode: 200,
      body: JSON.stringify('Hello from Lambda!'),
      };
      return response;
  };
</code></pre>
<ol start="3">
<li>Now run this function and press F5 and you can see the function now has environment variable <code>MY_VAR_1</code> with value: <code>Foo</code></li>
<li>Modify the code a bit:</li>
</ol>
<pre><code>  const AWS = require('aws-sdk');
  const lambda = new AWS.Lambda();

  exports.handler = async(event) => {
      const params = {
      FunctionName: "test-update-env",
      Environment: {
          Variables: {
          'MY_VAR_1': 'New Foo', // update process.env.MY_VAR_1 = 'New Foo'
          'MY_VAR_2': 'Bar', // Set process.env.MY_VAR_2 = 'Bar'
          }
      },
      };
      await lambda.updateFunctionConfiguration(params).promise();
      const response = {
      statusCode: 200,
      body: JSON.stringify('Hello from Lambda!'),
      };
      return response;
  };
</code></pre>
<ol start="5">
<li>Now run this again and you can see the function now has updated environment variable <code>MY_VAR_1</code> with a new value: <code>New foo</code> and new environment variable <code>MY_VAR_2</code> with value: <code>Bar</code></li>
</ol>
<p>Now you get the idea, you can get any value likes token from API call, calendar/booking data, ... and set/update it to environment variables.</p></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/aws-update-lambda-environment-variable-hack";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-72546b9ca477f57c2f2e.js"],"app":["/app-a6843f43ed10aa8685cb.js"],"component---src-pages-index-js":["/component---src-pages-index-js-1d2671ceb03571bd7d27.js"],"component---src-templates-blog-template-js":["/component---src-templates-blog-template-js-c62a2913b1733c7d003a.js"]};/*]]>*/</script><script src="/polyfill-72546b9ca477f57c2f2e.js" nomodule=""></script><script src="/component---src-templates-blog-template-js-c62a2913b1733c7d003a.js" async=""></script><script src="/app-a6843f43ed10aa8685cb.js" async=""></script><script src="/framework-acb96471af32e2ccbc9d.js" async=""></script><script src="/webpack-runtime-9f342ce237c6601c3595.js" async=""></script></body></html>